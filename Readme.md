# Программа учёта дополнительных занятий

Учёт посещаемости школьных кружков, составление отчётов и генерация счетов ученикам.

Программа работает в паре с сервером
https://github.com/shestero/teachserv .

## Описание рабочего процесса.

Программа dbschool, запускаемая на компьютере/ноутбуке в качестве исходных данных использует:
- список классов (classes.tsv);
- список учеников (students.tsv, со ссылкой на classes);
- список учителей (teachers.tsv);
- список кружков (sections.tsv, со ссылкой на teachers).
  Во всех этих таблицах значение первой колонки является целым id соотвествующей записи — первичным ключём.
  Структура этих таблиц повторяет структуру в БД, которая использовалась в предыдущей программе.
  TSV-файлы — простой текст в универсальной кодировке UTF-8 с разделителем — табуляция. Их можно открыть обычными прогаммами, например, MS Excel непосредственно.
  Конфигурация программы осуществаляется в файле dbschool.toml. В частности это адрес сервера и логин-пароль для связи с ним.
  Технически программа представляет собой толстый клиент на кросс-платформенном С++14/Qt5, используется сборщик Cmake.

Серверная часть написана на языке Rust.
Она хранит копию файла students.tsv (синхронизация автоматизирована, запускается специальной кнопкой программы dbschool). Настройка в файле teachserv.toml.

Процесс работы:
1) В программе dbschool создаются пустые таблицы посещаемости секций. При заполнении списка студентов в каждой секции используются данные из уже имеющихся таблиц за последние 120 дней (можно изменить параметром конфигурации window-days).
   Фаилы помещаются в папку attendance/outbox  получают имя уууу-кккк-ггггММдд_ччммсс.tsv где уууу — код (нормер) учителя (4 цифры), кккк — код кружка, далее идёт штамп дата-время создания.
   Таблицы генерируются от 14 числа предыдущего до 15 числа текущего месяца. Предполагается, что их будут делать не ранее 1-го перед 15-ым числом. (Также на этот момент посещаемость за предыдущий период должна быть уже получена, см.ниже).
2) С помощью специальной кнопки пустые таблицы перемещаются на сервер, где они помещаются в папку attendance/inbox.
3) Учителя заходят на сервер teachserv браузерами (можно с мобильных устройств) используя индивидуальные пароли, которые там хранятся в файле tpwd.tsv .
   Они видят свои незаполнееные таблицы и могут их заполнять, в том числе добавлять в них новых студентов (для этой функции необходим современный барузер с поддержкой DATALIST в HTML).
   Учителя могут заполнять одну и ту же таблицу постепенно, сохраняя изменения на сервере. В конце каждая таблица там должна быть «закрыта», после чего она перемещается на сервере в папку attendance/outbox.
   На сервере может быть заведён также нулевой «псевдо-учитель» Администратор, который имеет доступ к таблицам всех учитилей.
   На сервере таблицы храняться не более 100 дней (можно изменить параметром конфигурации max_table_age).
4) Программа dbschool по специальной кнопке забирается заполненные таблицы из папки сервера attendance/outbox себе в папку программы attendance/inbox.
   TODO: предупреждать об отсутствующих таблицах.
5) Программа dbschool по существующим в её папке attendance/inbox заполненным таблицам посещаемости может генерировать (на любой заданным месяц):
   5.1) Отчёт по учителям
   5.2) Отчёт директора
   5.3) Счета для каждого из учеников (каждый счёт в отдельном файле).
   Файлы создаются по-умолчанию в папке Документов текущего пользователя, их имена по-умолчанию начинаются с даты создания в формате гггг-дд-мм-… и имеют формат XLSX (MS Excel).
   Формулы в файлах сохраняются не пересчитанными; в зависимости от версии электронной таблицы после открытия может понадобиться запуск в ручную функции пересчёта формул(!)
